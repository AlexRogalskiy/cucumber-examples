cucumber-jvm-parallel-template  [![Build Status](https://travis-ci.com/iljapavlovs/cucumber-jvm-parallel-template.svg?branch=master)](https://travis-ci.com/iljapavlovs/cucumber-jvm-parallel-template)
=======================

CucumberJVM template project for running tests in parallel. 

This project was based on [Selenium-Maven-Template](https://github.com/Ardesco/Selenium-Maven-Template) and support for CucumberJVM was added

## How to run
### Execution options
 1. One "Runner" class per thread (use profile `parallel`). By "Runner" class is meant *RunCukesCheeseTest* class in this example.
    * **NOTE** - in order to use this approach, you will need to create separate "runner" class per one thread. Tests belonging to one "runner" class will be executed sequentially.
    * More on this read [here](https://opencredo.com/running-cucumber-jvm-tests-in-parallel/).
 2. Using [cucumber-jvm-parallel-plugin](https://github.com/temyers/cucumber-jvm-parallel-plugin) (use profile `parallelPlugin`)
    * *cucumber-jvm-parallel-plugin* will automatically generates "runner" classes.
    * More on this read [here](http://automationrhapsody.com/running-cucumber-tests-in-parallel/).
### Command for execution
```
./mvnw clean verify -P [nogrid OR grid],[parallel OR parallelPlugin] -Dthreads=[number of parallel threads]
```

* *parallel* - when using separate "runner" class per one thread
* *parallelPlugin* - uses cucumber-jvm-parallel-plugin. Automatically creates separate "runner" class per one thread
* *nogrid* - execute tests locally
* *grid* - execute tests on Selenium Grid. Grid Hub can be set in pom by using `seleniumGridUrl` property or in ApplicationProperties file 
* Thread count can be set via `-Dthreads` argument

For example, invoking 
```
./mvnw clean verify -P parallelPlugin,nogrid -Dthreads=3 -Dbrowser=chrome
``` 
will execute tests in parallel 3 threads on local machine and using *cucumber-jvm-parallel-plugin* plugin. In addition, `-Dbrowser` setting will set browser to Chrome.

OR
```
 ./mvnw clean verify -DremoteDriver=false -P onerunner -Dthreads=3 -Dbrowser=chrome -DuseTestcontainers=false -DenableVideo=false -DenableVNC=false 
```

## Configuration
Following settings can be changed in `lv.iljapavlovs.cucumber.config.ApplicationProperties.java` or overriden by from command line by providing `-D{configuration key}={value}` 

| Configuration key     | Description                                                       |
|-----------------------|----------------------|
| *env*   | environment name |
| *appUrl*       | AUT URL                 |
| *browser*     | Browser to use. Available options - `chrome, firefox, safari, edge, ie, chrome_headless, firefox_headless`                  |
| *proxyEnabled*    | is proxy enabled for Selenium (boolean) |
| *proxyHost* | proxy host                     |
| *proxyPort* | proxy port                    |
| *remoteDriver*  | should tests be executed on Selenium Grid (boolean)                       |
| *seleniumGridRetries* | RemoteWebdriver initialization retry count                |
| *seleniumGridUrl*     | Selenium Grid Hub URL                 |
| *waitShortSeconds*    | timeout for explicit wait - shortest timeout |
| *waitNormalSeconds* | timeout for explicit wait - average timeout                     |
| *waitLongSeconds* | timeout for explicit wait - longest timeout                      |


## Reporting
Reports are generated by [maven-cucumber-reporting](https://github.com/damianszczepanik/maven-cucumber-reporting) plugin and can be found under *target/site/cucumber-reports/cucumber-html-reports*

## Setting up Selenium Grid in Docker Containers

#### Selenium

```
docker-compose -f docker/docker-compose-selenium.yml up
```

##### Scaling
```
docker-compose scale selenium-hub=1 firefox=5 chrome=5 
```

### Selenoid - more in [Selenoid Configuration.md](Selenoid Configuration.md) 

1. Pull desired browser images for testing
```
docker pull selenoid/vnc:chrome_68.0
```

Optionally, if you want video recording enabled, then corresponding image needs to be pulled
```
docker pull selenoid/video-recorder
```
2. Start Selenoid
```
docker-compose -f docker/docker-compose-selenoid.yml up
```

#### Zalenium

```
docker-compose -f docker/docker-compose-zalenium.yml up --force-recreate
```


## Running Tests against these Selenium Grid implementations
```
 ./mvnw clean verify -DremoteDriver=true -P onerunner -Dthreads=3 -Dbrowser=chrome -DuseTestcontainers=false -DenableVideo=false -DenableVNC=false 
```

```
 ./mvnw clean verify -Denv=test -DenableVNC=true -DenableVideo=true
```

`-Denv=test` - uses `remoteDriver=true` in ApplicationProperties.java

## Driver Download for local execution
This project uses [webdrivermanager](https://github.com/bonigarcia/webdrivermanager) tool in order to automate the Selenium browser drivers management in runtime. It will **automatically** download all needed driver to your local PC if needed with specified version.



## Cucumber >1.2.5

* Parameter Types:
    * Type Registry - https://cucumber.io/docs/cucumber/configuration/
    * https://github.com/cucumber/cucumber-jvm/blob/master/examples/java-calculator/src/test/java/io/cucumber/examples/java/ParameterTypes.java


* [Spring Boot and Cucumber Tests](https://medium.com/@bcarunmail/set-up-and-run-cucumber-tests-in-spring-boot-application-d0c149d26220)
    * https://github.com/bcarun/cucumber-samples/tree/master/hello-springboot-cucumber
    * **Cucumber**:
        * TypeRegistryConfigurer (CucumberTypeRegistryConfigurer) - from DataTable to Model via Jackson
        * cucumber-reporting from `net.masterthought` configuration
        > 1.If you decide to use Cucumber Report plugin configured above, replace ‘@RunWith(Cucumber.class)’ with ‘@RunWith(CucumberReportRunner.class)’ in CucumberTest.java file.
          2. CucumberReportRunner.java extends Cucumber.java
          3. CucumberReportRunner generates reports from the file at target/cucumber-report.json
          4. CucumberReportRunner copies the generated html reports to target/classes/static directory so that the reports are packaged along with the application.
```
public class CucumberReportRunner extends Cucumber {

  // Can be dynamically pulled from CI Server
  private static final String PROJECT_NAME = "Hello Cucumber & Spring Boot";
  private static final String BUILD_NUMBER = "1.0.0";
  private static final String BRANCH_NAME = "master";

  public CucumberReportRunner(Class clazz) throws InitializationError {
    super(clazz);
  }

  @Override
  public void run(RunNotifier notifier) {
    super.run(notifier);
    generateReport();
  }

  public static void generateReport() {

    File reportOutputDirectory = new File("target/classes/static");
    List<String> jsonFiles = new ArrayList<>();
    jsonFiles.add("target/cucumber-report.json");

    // set values from respective build tool
    Configuration configuration = new Configuration(reportOutputDirectory, PROJECT_NAME);
    configuration.setBuildNumber(BUILD_NUMBER);
    configuration.addClassifications("Build Number", configuration.getBuildNumber());
    configuration.addClassifications("Branch Name", BRANCH_NAME);

    ReportBuilder reportBuilder = new ReportBuilder(jsonFiles, configuration);
    reportBuilder.generateReports();
  }
}
```
